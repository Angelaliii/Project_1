# 變更與需求草案（清晰版）

## 概要

此文件整理系統需求與建議解法，並在每個項目標註「接受準則」與「不確定/需確認」的事項。請先確認此文件（尤其是不確定處），確認無誤後我會依此開始修改程式碼並實作功能。

## 使用者權限（目前已確定）

備註：單一帳號可能同時擁有多種權限（例如：教師兼系所秘書）。

## 使用者權限（整合你的回覆）

- **主要借用對象**：以「系所秘書」與「教師」為主。
- **管理員（Admin）**：系統具有管理員角色，為最高權限者，負責管理教室、開關租借權限與匯出統計等。
- **系所（秘書）**：可管理本系/單位的帳號與協助審核、修改借用紀錄（具備跨帳號操作權限）。
- **教師**：可提出借用與管理個人課程排定。
- **學生**：在特定資源（如學習討論室）中可開放借用，但需授權／擁有借用權限才能申請。

備註：單一帳號可同時擁有多種權限（例如：教師兼系所秘書）。

已決事項（依你的回覆）

- 帳號匯入：支援以 EXCEL（建議 CSV 或 .xlsx）方式進行批次匯入。匯入欄位採用：`account, name, email, unit, roles, initial_password`（可由管理端或系所秘書上傳）。\
- 顏色標註：灰色 = 已過期、紅色 = 已借用、咖啡色 = 已排課（課程）。\
- 借用成功通知：租借成功後系統會寄信給使用者，信件使用註冊或匯入時的電子郵件，信中包含注意事項。系統目前以 PHPMailer 實作 Email 發送。\
- 取消借用：系統已有取消功能；取消時會寄信通知管理端（可視情況決定是否只在臨時取消時才通知）。\
- 教室詳細資訊：同意新增教室詳細頁面或 tooltip，展示功能、容納人數、照片等。\
- 統計與匯出：管理端將提供網頁檢視與 CSV/Excel 匯出功能（例如：單一學院使用狀況、學期使用狀況、排課與臨借率）。\
- 錄播與設備選項：同意在借用流程中加入錄播選項、是否需中心人員協助錄播，以及設備借用選項（如自備筆電、投影、麥克風）。\
- 攝影棚/錄音室/教材自製室：可納入預約系統。\
- 借用權限開關：由 `管理員` 全權操作（管理者可開/關整體租借權限）；`系所（秘書）` 可管理本系帳號與本系範圍內的設定，但無法變更系統全域租借權限。\
- 轉讓流程：教室借用之轉讓需由管理端介入執行並留下操作紀錄（AB 自行協商後需管理者在系統中執行轉讓，以便留存紀錄）。\
- 代表帳號設定：暫時設定 `angela20151210@gmail.com` 同時擁有 `教師` 與 `管理員` 權限。\
- 學號驗證：暫時不串接學生資料庫進行學號比對（先以表單紀錄學生學號/系所/Email）。\
- 通知方式：以 Email 為主（已用 PHPMailer 實作）；系統內通知中心為後續擴充項目。\
- 月度次數限制：保留「一個月三次」的借用限制規則（後端檢查）。

## 需你回覆或確認的重點（摘錄）

- 借用權限開關：由 `管理員` 全權操作？或授權 `系所（秘書）` 可管理本系權限？
- 借用轉讓流程：AB 自行協商後直接在系統變更，或由管理端執行且需通知所有相關方？
- 帳號匯入欄位：最終 CSV/Excel 欄位範例（可接受：`account, name, email, unit, roles, initial_password`）。
- 學號驗證：是否要串接學生資料庫做比對驗證？
- 通知方式：僅 Email、或同時提供系統內通知（通知中心）？
- 月度/次數限制：目前規則（如：一個月三次）是否保留或需調整？

## 請就上述重點回覆，我會依你的選擇更新系統設計並開始分階段實作。

## 需求清單（逐項說明）

1. 帳號批量匯入（Excel/CSV）

- 需求說明：提供表格上傳，批次建立/更新帳號（以利系所秘書快速建檔）。
- 接受準則：上傳欄位包含：帳號、姓名、電子郵件、系所、角色（可多選）；匯入後能回報錯誤行與結果摘要。\
- 建議解法：新增匯入頁面，解析 CSV/Excel（建議先以 CSV 支援為主），匯入前顯示預覽與欄位對應。\
- 不確定/需確認：欲支援欄位完整清單、是否允許密碼自動產生或寄送初始密碼、誰可以使用此功能（是否僅系所秘書與管理員）。

2. 教室排課與借用時間視覺化（顏色標註）

- 需求說明：日曆/時間表需明確區分「已排課（課程）」與「已借用（活動）」，以不同顏色或樣式顯示。\
- 接受準則：日/周檢視中，同一時間段若存在課程與借用，能清楚標示衝突或優先級。\
- 建議解法：在前端日曆（目前使用的 JS 日曆函式庫）定義狀態標籤並套用 CSS 顏色。\
- 不確定/需確認：使用哪些顏色或樣式、課程與借用之間的優先級規則（例如：學校課程是否優先於臨時借用）。

3. 借用審核後自動通知（Email/系統通知）

- 需求說明：借用申請一旦審核（通過/拒絕/條件式通過），自動通知申請人與相關管理者。\
- 接受準則：審核後立即發送通知，並在使用者的通知中心保留紀錄；若為 Email，需有可設定的範本。\
- 建議解法：後端新增通知隊列，整合 SMTP 或校內郵件設定；提供通知範本管理。\
- 不確定/需確認：系統是否已有 SMTP/郵件服務設定、是否要支援內部即時通知（WebSocket/推播）。

4. 管理端備註欄位

- 需求說明：管理者在借用紀錄上能加註備註（內部註記），備註只供管理端查看。\
- 接受準則：備註可新增/編輯/刪除；備註顯示於借用詳細頁與輸出匯出中。\
- 建議解法：在借用紀錄 DB 表新增備註欄位或建立備註子表，並在後端提供 API。\
- 不確定/需確認：備註是否需分權限（例如：只有管理員可見 vs 系所可見）。

5. 多視圖時間範圍（單日 / 一週 / 自訂區間）

- 需求說明：在預約界面新增週視圖與自訂時間區間檢視，方便瀏覽多日預約。\
- 接受準則：提供日/週/自訂（起迄）檢視並可切換。\
- 建議解法：延伸目前日曆元件，新增週模式並實作時間區間查詢 API。\
- 不確定/需確認：前端目前使用的日曆元件是否支援週視圖或需替換元件。

6. 借用取消與自動通知管理端

- 需求說明：申請人可在規定時間內取消借用，取消後系統通知負責審核或管理者。\
- 接受準則：取消流程記錄用戶操作、發送通知、更新可用時段。\
- 建議解法：在前端提供取消按鈕並呼叫 API，後端驗證取消條件後發送通知。\
- 不確定/需確認：取消的時限規則（例如：必須在使用前 X 小時取消）及誰接收通知。

7. 教室借用轉讓（由管理端操作）

- 需求說明：管理端能在特殊情況下把已核准的借用轉讓給其他單位/人員，並產生變更紀錄。\
- 接受準則：轉讓需保留原紀錄、建立新的借用紀錄或更新歸屬，並可追蹤操作人員。\
- 建議解法：後端新增轉讓 API，前端提供操作介面與確認流程。\
- 不確定/需確認：是否允許使用者自行轉讓（或僅管理端），以及轉讓後是否需再次審核。

8. eSchool 非一般時段借用費用提醒

- 需求說明：若借用發生於非一般時段，系統在申請或審核時提醒可能的額外費用（清潔、加班等）。\
- 接受準則：申請表單顯示額外費用說明，審核時彈出對應提示。\
- 建議解法：在教室設定中新增時段屬性與對應費用表，前端在申請時查詢並顯示。\
- 不確定/需確認：額外費用的計算規則與金額來源（是否由管理端設定或來自外部系統）。

9. 學習討論室借用（學生專用欄位）

- 需求說明：開放學習討論室借用，對申請者要求填寫學號、系所與電子郵件等資訊以便身分驗證。\
- 接受準則：表單強制欄位為學號與系所；驗證可比對校內帳號或僅作紀錄。\
- 建議解法：新增討論室資源類型與專用申請表單欄位，並在後端儲存欄位資料。\
- 不確定/需確認：是否需實作學號驗證（例如：查詢學生資料庫或 API）。

10. 教室詳細資訊頁面

- 需求說明：為每間教室顯示功能、容納人數、設備清單、照片、可借用時段與注意事項。\
- 接受準則：詳細頁面應含至少：標題、容納人數、設備（投影/錄播/麥克風）、展示圖片與備註。\
- 建議解法：擴充教室資料模型與管理後台，前端提供詳細檢視頁。\
- 不確定/需確認：每間教室是否需多張照片上傳介面與照片尺寸/格式限制。

11. 管理端統計與匯出功能

- 需求說明：提供按學院、系所、學期、月份等範圍的使用統計，並可匯出 CSV 或 Excel。\
- 接受準則：能產生期間內使用次數、使用率、熱門教室等指標，並支援 CSV/Excel 匯出。\
- 建議解法：新增後端報表 API，前端提供過濾條件與匯出按鈕。\
- 不確定/需確認：需哪些具體指標（例如：使用時數 vs 使用次數）與匯出欄位格式。

12. 教室錄播功能選項

- 需求說明：借用時可勾選是否需要錄播服務或錄播設備。\
- 接受準則：申請表單包含錄播選項；後端能記錄並在管理端列出需支援的借用。\
- 建議解法：在教室設備清單中標示錄播能力，申請表單加入勾選欄位。\
- 不確定/需確認：錄播服務是否需額外審核、是否產生費用或需排班技術人員。

13. eSchool 設備借用選項

- 需求說明：在 eSchool 借用流程中新增設備借用欄位（如：投影、筆電、麥克風）與錄播需求。\
- 接受準則：申請表能記錄所需設備，管理端可查看並分配設備。\
- 建議解法：設備列為可借用資產，與借用紀錄關聯；管理端有設備庫存管理介面。\
- 不確定/需確認：設備盤點機制與借用優先順序。

14. 攝影棚 / 錄音室 / 教材自製室納入預約系統

- 需求說明：把專業設施納入同一預約平台，支援時段、設備與人員需求的記錄。\
- 接受準則：可在資源列表中新增上述設施，並支援專門欄位（例如：使用類型、所需技術人員）。\
- 建議解法：將此類設施視為資源類型，擴充資源屬性與管理後台。\
- 不確定/需確認：是否需額外審核流程、是否有外部系統整合（例如：錄音室排程管理）。

---

## 未決事項總表（需你確認）

- 欄位清單與格式：帳號匯入需要哪些欄位（CSV 欄位名稱）？是否支援 Excel 檔（.xlsx）？\
- 郵件服務：系統是否已有 SMTP/郵件服務設定？通知要用 Email、系統通知或兩者？\
- 權限細節：不同角色在「審核」、「匯出」、「轉讓」等操作上的具體權限配置。\
- 視覺/UX 細節：顏色配置、日曆元件是否可直接擴充。\
- 費用計算規則：非一般時段的額外費用標準由誰維護？\

## 下一步（我的建議工作流程）

- 1. 你確認本檔案內容與未決事項（指明優先處理項目與回答不確定問題）。\
- 2. 我根據確認開始實作：先從最小值可行功能（帳號匯入 CSV、基礎通知、日曆顏色標註）逐步推進。\
- 3. 每個主要功能完成後我會建立 PR（或直接在本分支提交），並附上使用說明與測試步驟。

---

請閱讀上述草案，針對「未決事項總表」逐條回覆或補充。我會依你的回覆進行下一步程式修改。若你希望我先修改程式碼也請明確授權我要開始哪一項功能的開發。
